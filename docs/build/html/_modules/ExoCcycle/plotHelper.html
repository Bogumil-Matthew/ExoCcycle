<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ExoCcycle.plotHelper &#8212; ExoCcycle  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ExoCcycle.plotHelper</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Nov 7 2025</span>

<span class="sd">@author: Matthew Bogumil</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#######################################################################</span>
<span class="c1">############################### Imports ###############################</span>
<span class="c1">#######################################################################</span>
<span class="c1"># Import general libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>

<span class="c1"># Import analysis libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Import plotting </span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span> <span class="c1"># type: ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSpec</span>

<span class="c1"># Import other modules</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ExoCcycle</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bathymetry</span>    <span class="c1"># type: ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ExoCcycle</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>         <span class="c1"># type: ignore</span>


<span class="c1">########################################################################</span>
<span class="c1">################ Plotting functions (Global-Regional)  #################</span>
<span class="c1">########################################################################</span>
<div class="viewcode-block" id="plotGlobal">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plotGlobal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotGlobal</span><span class="p">(</span>
    <span class="n">lat</span><span class="p">,</span>
    <span class="n">lon</span><span class="p">,</span>
    <span class="n">values</span><span class="p">,</span>
    <span class="n">outputDir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">fidName</span><span class="o">=</span><span class="s2">&quot;plotGlobal.png&quot;</span><span class="p">,</span>
    <span class="n">cmapOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-title&quot;</span><span class="p">:</span> <span class="s2">&quot;cbar-title&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="s2">&quot;cbar-levels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
    <span class="n">pltOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;valueType&quot;</span><span class="p">:</span> <span class="s2">&quot;Bathymetry&quot;</span><span class="p">,</span>
             <span class="s2">&quot;valueUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotTitle&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotZeroContour&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;transparent&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
             <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(),</span>
             <span class="s2">&quot;regionalZBoundaries&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">saveSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">savePNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a global (or regional) gridded field on a map projection using Cartopy.</span>

<span class="sd">    The function renders a latitude/longitude gridded dataset with optional mesh</span>
<span class="sd">    shading, coastlines, contours (zero or integer/label-like boundaries),</span>
<span class="sd">    regional masking and recoloring, and a horizontally oriented colorbar.</span>
<span class="sd">    Saving to PNG and/or SVG is supported.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray):  </span>
<span class="sd">            2-D array of **cell-centered** latitudes in degrees (same shape as ``values``),</span>
<span class="sd">            typically spanning ``[-90, 90]`` row-wise.</span>
<span class="sd">        lon (numpy.ndarray):  </span>
<span class="sd">            2-D array of **cell-centered** longitudes in degrees (same shape as ``values``),</span>
<span class="sd">            typically spanning ``[-180, 180]`` column-wise.</span>
<span class="sd">        values (numpy.ndarray):  </span>
<span class="sd">            2-D array of gridded data (same shape as ``lat``/``lon``). May include ``NaN``.</span>
<span class="sd">        outputDir (str, optional):  </span>
<span class="sd">            Directory to which the figure is saved. Defaults to ``&quot;&quot;`` (current behavior</span>
<span class="sd">            depends on Matplotlibâ€™s savefig path).</span>
<span class="sd">        fidName (str, optional):  </span>
<span class="sd">            Base filename for outputs (PNG and/or SVG). Defaults to ``&quot;plotGlobal.png&quot;``.</span>
<span class="sd">        cmapOpts (dict, optional):  </span>
<span class="sd">            Colormap and colorbar configuration. Recognized keys:</span>
<span class="sd">            - ``&quot;cmap&quot;`` (str or Colormap): Matplotlib colormap name or object.  </span>
<span class="sd">            - ``&quot;cbar-title&quot;`` (str): Title text for the colorbar (not always used).  </span>
<span class="sd">            - ``&quot;cbar-range&quot;`` (list[float, float]): ``[vmin, vmax]`` for color scaling.  </span>
<span class="sd">            - ``&quot;cbar-levels&quot;`` (list[float]): Optional levels.  </span>
<span class="sd">              (Note: passed to ``pcolormesh`` in a guarded try/except.)</span>
<span class="sd">        pltOpts (dict, optional):  </span>
<span class="sd">            Plot behavior and aesthetics. Recognized keys:</span>
<span class="sd">            - ``&quot;valueType&quot;`` (str): Label for data type, used in colorbar label.  </span>
<span class="sd">            - ``&quot;valueUnits&quot;`` (str): Units string for colorbar label.  </span>
<span class="sd">            - ``&quot;plotTitle&quot;`` (str): Figure title.  </span>
<span class="sd">            - ``&quot;plotZeroContour&quot;`` (bool): If True, overlay a contour at value 0.  </span>
<span class="sd">            - ``&quot;plotIntegerContours&quot;`` (bool): If True, draw boundaries around integer-valued regions.  </span>
<span class="sd">            - ``&quot;transparent&quot;`` (bool): If True, save figures with transparent background.  </span>
<span class="sd">            - ``&quot;region&quot;`` (list[float, float, float, float]): ``[lon_min, lon_max, lat_min, lat_max]``  </span>
<span class="sd">              extent in degrees. Full-globe default is ``[-180, 180, -90, 90]``.  </span>
<span class="sd">            - ``&quot;projection&quot;`` (cartopy.crs.Projection): Target map projection (default Mollweide).  </span>
<span class="sd">            - ``&quot;regionalZBoundaries&quot;`` (bool): If True, mask outside ``region`` and remap</span>
<span class="sd">              in-range values to consecutive integers starting at 0, updating the colorbar range.  </span>
<span class="sd">            - ``&quot;mesh&quot;`` (bool): If True, draw shaded mesh with ``pcolormesh`` (default True).  </span>
<span class="sd">            - ``&quot;nanSolidPoly&quot;`` (bool): If True, render NaN cells as solid polygons.  </span>
<span class="sd">            - ``&quot;nanSolidPolyOutline&quot;`` (bool): If True, outline contiguous NaN regions.  </span>
<span class="sd">            - ``&quot;coastlines&quot;`` (bool): If True, draw coastlines (blue, 1 px).</span>
<span class="sd">        saveSVG (bool, optional):  </span>
<span class="sd">            If True, saves an SVG copy (filename derived from ``fidName``). Defaults to False.</span>
<span class="sd">        savePNG (bool, optional):  </span>
<span class="sd">            If True, saves a PNG copy (uses ``fidName``). Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None:  </span>
<span class="sd">            Writes a figure to disk if ``savePNG`` and/or ``saveSVG`` is True. Does not return a value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:  </span>
<span class="sd">            If array shapes of ``lat``, ``lon``, and ``values`` are inconsistent. *(Not enforced here; caller responsibility.)*</span>
<span class="sd">        FileNotFoundError:  </span>
<span class="sd">            If ``outputDir`` does not exist or is not writable. *(Depends on Matplotlib/OS behavior.)*</span>
<span class="sd">        Exception:  </span>
<span class="sd">            Any Matplotlib/Cartopy errors encountered during plotting or saving.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - ``pltOpts[&quot;regionalZBoundaries&quot;]`` masks values outside the ``region`` and then</span>
<span class="sd">          renumbers unique in-region values to contiguous integers starting at 0, updating</span>
<span class="sd">          ``cmapOpts[&quot;cbar-range&quot;]`` accordingly.  </span>
<span class="sd">        - If ``pltOpts[&quot;plotZeroContour&quot;]`` is True, NaNs in ``values`` are set to 0 for contouring.  </span>
<span class="sd">        - The colorbar tick spacing is heuristically derived from ``&quot;cbar-range&quot;`` to produce</span>
<span class="sd">          ~4 ticks.  </span>
<span class="sd">        - Gridlines are labeled for regional plots and unlabeled for full-globe plots.  </span>
<span class="sd">        - ``pcolormesh`` is called with ``transform=ccrs.PlateCarree()`` to map lon/lat to the projection.</span>

<span class="sd">    Example:</span>
<span class="sd">        Render a global field in a Mollweide projection and save a PNG:</span>

<span class="sd">        ```python</span>
<span class="sd">        cmapOpts = {&quot;cmap&quot;: &quot;viridis&quot;, &quot;cbar-range&quot;: [-6000, 6000], &quot;cbar-levels&quot;: [-6000, 0, 6000]}</span>
<span class="sd">        pltOpts = {&quot;valueType&quot;: &quot;Topography&quot;, &quot;valueUnits&quot;: &quot;m&quot;, &quot;plotTitle&quot;: &quot;ETOPO1&quot;,</span>
<span class="sd">                   &quot;projection&quot;: ccrs.Mollweide(), &quot;region&quot;: [-180, 180, -90, 90],</span>
<span class="sd">                   &quot;plotZeroContour&quot;: True, &quot;coastlines&quot;: True}</span>
<span class="sd">        plotGlobal(lat, lon, z, outputDir=&quot;figs&quot;, fidName=&quot;etopo1.png&quot;,</span>
<span class="sd">                   cmapOpts=cmapOpts, pltOpts=pltOpts, savePNG=True)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Copy values such that the arguments are not changed, if</span>
    <span class="c1"># say they are from a class attribute.</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Start making figure</span>
    <span class="c1">## Create a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    
    <span class="c1">## Set projection and extent</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">())</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>

    <span class="c1">## Set up the Mollweide projection</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    
    <span class="c1">## Set default for option to use regional Zvalue boundaries</span>
    <span class="n">regionalZBoundaries</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regionalZBoundaries&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">regionalZBoundaries</span><span class="p">:</span>
        <span class="c1"># Set values outside of region to nan</span>
        <span class="n">values</span><span class="p">[</span> <span class="o">~</span><span class="p">((</span><span class="n">lon</span><span class="o">&gt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lon</span><span class="o">&lt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lat</span><span class="o">&gt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lat</span><span class="o">&lt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Reset indexing</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">values</span><span class="o">==</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span>
                <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
        
        <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
        
    <span class="c1">## Set if the mesh should be plotted</span>
    <span class="n">meshOpt</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mesh&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        
    <span class="c1">## Set if solid polygons should be plotted for nan values.</span>
    <span class="n">nanSolidPoly</span>        <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nanSolidPoly&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">nanSolidPolyOutline</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nanSolidPolyOutline&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1">## Set if the coastline should be plotted</span>
    <span class="n">coastlinesOpt</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coastlines&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>

    <span class="c1">## Set option to add contour for zero value</span>
    <span class="n">plotZeroContour</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotZeroContour&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
    
    <span class="c1">## Set default option for plotIntegerContours</span>
    <span class="n">plotIntegerContours</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>

    <span class="c1">## Add the plot using pcolormesh</span>
    <span class="k">if</span> <span class="n">meshOpt</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">levels</span> <span class="o">=</span> <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-levels&quot;</span><span class="p">],</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    

    <span class="c1">## Add zero value contour</span>
    <span class="k">if</span> <span class="n">plotZeroContour</span><span class="p">:</span>
        <span class="c1"># Set any np.nan values to 0.ccrs</span>
        <span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">zeroContour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1">## Add solid polygons for nan values</span>
    <span class="k">if</span> <span class="n">nanSolidPoly</span><span class="p">:</span>
        <span class="n">valuesNan</span>                   <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">valuesNan</span><span class="p">[:]</span>                <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span>
        <span class="n">valuesNan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">mesh2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesNan</span><span class="p">,</span>
                              <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1">## Add Line around clusters of nan values</span>
    <span class="k">if</span> <span class="n">nanSolidPolyOutline</span><span class="p">:</span>
        <span class="n">valuesNan</span>                   <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">valuesNan</span><span class="p">[:]</span>                <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">valuesNan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">nanContour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesNan</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">## Add contours in integer steps (useful for dividing catagorical data)</span>
    <span class="n">valuesContour</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotIntegerContours</span><span class="p">:</span>
        <span class="c1"># Set any np.nan values to 0.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">))):</span>
            <span class="n">valuesContour</span><span class="p">[</span><span class="n">values</span><span class="o">==</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">valuesContour</span><span class="p">[</span><span class="n">values</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesContour</span><span class="p">,</span>
                       <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                       <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">## Add coastlines</span>
    <span class="k">if</span> <span class="n">coastlinesOpt</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1">## Add a colorbar</span>
    <span class="k">if</span> <span class="n">meshOpt</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="c1">## Set four tick marks with integer values unless</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">sep</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">])</span><span class="o">/</span><span class="n">sep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">])</span><span class="o">//</span><span class="n">sep</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">))</span>
        
        <span class="c1">## Set cbar name</span>
        <span class="k">if</span> <span class="n">regionalZBoundaries</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Regional </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust the size of colorbar ticks</span>

    <span class="c1">## Add gridlines</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">):</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                          <span class="n">xlocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                          <span class="n">ylocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                         <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                          <span class="n">xlocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                          <span class="n">ylocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                         <span class="p">)</span>

        <span class="n">gl</span><span class="o">.</span><span class="n">xlabels_top</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabels_bottom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabels_left</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabels_right</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set the tick label color here</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="c1">## Set a title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;plotTitle&#39;</span><span class="p">])</span>

    <span class="c1">## Set transparency value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">];</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="c1"># Save figure</span>
    <span class="k">if</span> <span class="n">savePNG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">saveSVG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="plotGlobalwBoundaries">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plotGlobalwBoundaries">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotGlobalwBoundaries</span><span class="p">(</span>
    <span class="n">lat</span><span class="p">,</span>
    <span class="n">lon</span><span class="p">,</span>
    <span class="n">values</span><span class="p">,</span>
    <span class="n">BasinIDA</span><span class="p">,</span>
    <span class="n">outputDir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">fidName</span><span class="o">=</span><span class="s2">&quot;plotGlobal_wBoundaries.png&quot;</span><span class="p">,</span>
    <span class="n">cmapOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;jet&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-title&quot;</span><span class="p">:</span> <span class="s2">&quot;cbar-title&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
    <span class="n">pltOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;valueType&quot;</span><span class="p">:</span> <span class="s2">&quot;Silhouette Structure&quot;</span><span class="p">,</span>
             <span class="s2">&quot;valueUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotTitle&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotZeroContour&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;nanSolidPoly&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s2">&quot;nanSolidPolyOutline&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s2">&quot;regionalZBoundaries&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
             <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(),</span>
             <span class="s2">&quot;transparent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">saveSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">savePNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a global (or regional) scalar field with overlaid basin boundaries.</span>

<span class="sd">    Renders a gridded field (``values``) on a Cartopy map projection with optional</span>
<span class="sd">    masking to a region, solid polygons/contours to visualize NaN areas, and</span>
<span class="sd">    integer-boundary contours derived from a basin-ID array (``BasinIDA``). A</span>
<span class="sd">    horizontal colorbar is added when mesh shading is enabled. PNG and SVG export</span>
<span class="sd">    are supported.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray):  </span>
<span class="sd">            2-D array of **cell-centered** latitudes (degrees), same shape as ``values``.</span>
<span class="sd">        lon (numpy.ndarray):  </span>
<span class="sd">            2-D array of **cell-centered** longitudes (degrees), same shape as ``values``.</span>
<span class="sd">        values (numpy.ndarray):  </span>
<span class="sd">            2-D array of scalar data to shade (same shape as ``lat``/``lon``). May include ``NaN``.</span>
<span class="sd">        BasinIDA (numpy.ndarray):  </span>
<span class="sd">            2-D array of integer (or categorical) basin IDs aligned with ``values`` for</span>
<span class="sd">            boundary visualization (integer-step contouring and NaN overlays).</span>
<span class="sd">        outputDir (str, optional):  </span>
<span class="sd">            Directory to which the figure is saved. Defaults to ``&quot;&quot;`` (current behavior</span>
<span class="sd">            depends on Matplotlibâ€™s savefig path).</span>
<span class="sd">        fidName (str, optional):  </span>
<span class="sd">            Output filename for PNG; used as base to derive SVG name. Defaults to</span>
<span class="sd">            ``&quot;plotGlobal_wBoundaries.png&quot;``.</span>
<span class="sd">        cmapOpts (dict, optional):  </span>
<span class="sd">            Colormap and colorbar configuration. Recognized keys:</span>
<span class="sd">            - ``&quot;cmap&quot;`` (str): Colormap name (resolved via ``plt.cm.get_cmap``).  </span>
<span class="sd">            - ``&quot;cbar-title&quot;`` (str): Title for the colorbar (not always used).  </span>
<span class="sd">            - ``&quot;cbar-range&quot;`` (list[float, float]): ``[vmin, vmax]``.</span>
<span class="sd">        pltOpts (dict, optional):  </span>
<span class="sd">            Plot behavior and aesthetics. Recognized keys:</span>
<span class="sd">            - ``&quot;valueType&quot;`` (str): Label for data type (used in colorbar label).  </span>
<span class="sd">            - ``&quot;valueUnits&quot;`` (str): Units string for colorbar label.  </span>
<span class="sd">            - ``&quot;plotTitle&quot;`` (str): Figure title text.  </span>
<span class="sd">            - ``&quot;plotZeroContour&quot;`` (bool): If True, contour a zero isoline of ``values``.  </span>
<span class="sd">            - ``&quot;nanSolidPoly&quot;`` (bool): If True, shade NaN regions (from ``BasinIDA``) as solid polygons.  </span>
<span class="sd">            - ``&quot;nanSolidPolyOutline&quot;`` (bool): If True, outline contiguous NaN regions (from ``BasinIDA``).  </span>
<span class="sd">            - ``&quot;plotIntegerContours&quot;`` (bool): If True, draw boundaries for each integer basin ID.  </span>
<span class="sd">            - ``&quot;regionalZBoundaries&quot;`` (bool): If True, mask ``values`` outside ``region`` and remap</span>
<span class="sd">              surviving unique values to 0..N-1; updates ``cmapOpts[&quot;cbar-range&quot;]``.  </span>
<span class="sd">            - ``&quot;region&quot;`` (list[float, float, float, float]): ``[lon_min, lon_max, lat_min, lat_max]`` extent.  </span>
<span class="sd">            - ``&quot;projection&quot;`` (cartopy.crs.Projection): Target map projection (default Mollweide).  </span>
<span class="sd">            - ``&quot;transparent&quot;`` (bool): If True, save with transparent background.  </span>
<span class="sd">            - ``&quot;boundaryColor&quot;`` (str, optional): Color for integer boundary contours (default ``&#39;k&#39;``).  </span>
<span class="sd">            - ``&quot;boundaryLinewidth&quot;`` (float, optional): Line width for boundary contours (default ``1``).  </span>
<span class="sd">            - ``&quot;mesh&quot;`` (bool, optional): If True, render the shaded mesh (default True).</span>
<span class="sd">        saveSVG (bool, optional):  </span>
<span class="sd">            If True, also save an SVG (name derived from ``fidName``). Defaults to False.</span>
<span class="sd">        savePNG (bool, optional):  </span>
<span class="sd">            If True, save a PNG using ``fidName``. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None:  </span>
<span class="sd">            Writes a figure to disk when ``savePNG`` and/or ``saveSVG`` is True.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:  </span>
<span class="sd">            If input array shapes are inconsistent. *(Not validated here; caller responsibility.)*</span>
<span class="sd">        FileNotFoundError:  </span>
<span class="sd">            If ``outputDir`` is invalid/unwritable. *(Depends on Matplotlib/OS behavior.)*</span>
<span class="sd">        Exception:  </span>
<span class="sd">            Any Matplotlib/Cartopy errors encountered during plotting or saving.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - ``regionalZBoundaries``: values outside the extent are set to ``NaN``; remaining unique</span>
<span class="sd">          values are renumbered sequentially starting at 0 to create a compact categorical range.  </span>
<span class="sd">        - Integer boundary contours are derived from ``BasinIDA`` by thresholding each ID and</span>
<span class="sd">          contouring at 0.5.  </span>
<span class="sd">        - NaN overlays/contours are also computed from ``BasinIDA``â€™s NaN mask (not ``values``)</span>
<span class="sd">          to highlight missing/invalid basins.  </span>
<span class="sd">        - Colormap is resolved via ``plt.cm.get_cmap(cmapOpts[&quot;cmap&quot;])``.  </span>
<span class="sd">        - Gridlines are labeled for regional plots and hidden for full-globe plots.  </span>
<span class="sd">        - ``pcolormesh`` uses ``transform=ccrs.PlateCarree()`` to project lon/lat to the target projection.</span>

<span class="sd">    Example:</span>
<span class="sd">        Plot silhouette values with basin boundaries and save a transparent PNG:</span>

<span class="sd">        ```python</span>
<span class="sd">        pltOpts = {</span>
<span class="sd">            &quot;valueType&quot;: &quot;Silhouette&quot;,</span>
<span class="sd">            &quot;valueUnits&quot;: &quot;-&quot;,</span>
<span class="sd">            &quot;plotTitle&quot;: &quot;Basins &amp; Silhouette&quot;,</span>
<span class="sd">            &quot;projection&quot;: ccrs.Mollweide(),</span>
<span class="sd">            &quot;region&quot;: [-180, 180, -90, 90],</span>
<span class="sd">            &quot;plotIntegerContours&quot;: True,</span>
<span class="sd">            &quot;transparent&quot;: True</span>
<span class="sd">        }</span>
<span class="sd">        cmapOpts = {&quot;cmap&quot;: &quot;viridis&quot;, &quot;cbar-range&quot;: [0, 1]}</span>
<span class="sd">        plotGlobalwBoundaries(lat, lon, silhouette, basin_ids,</span>
<span class="sd">                              outputDir=&quot;figs&quot;,</span>
<span class="sd">                              fidName=&quot;silhouette_basins.png&quot;,</span>
<span class="sd">                              cmapOpts=cmapOpts, pltOpts=pltOpts,</span>
<span class="sd">                              savePNG=True)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Copy values such that the arguments are not changed, if</span>
    <span class="c1"># say they are from a class attribute.</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Start making figure</span>
    <span class="c1">## Create a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    
    <span class="c1">## Set projection and extent</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">())</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>

    <span class="c1">## Set up the Mollweide projection</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    
    <span class="c1">## Set default for option to use regional Zvalue boundaries</span>
    <span class="n">regionalZBoundaries</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regionalZBoundaries&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">regionalZBoundaries</span><span class="p">:</span>
        <span class="c1"># Set values outside of region to nan</span>
        <span class="n">values</span><span class="p">[</span> <span class="o">~</span><span class="p">((</span><span class="n">lon</span><span class="o">&gt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lon</span><span class="o">&lt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lat</span><span class="o">&gt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lat</span><span class="o">&lt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Reset indexing</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">values</span><span class="o">==</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span>
                <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
        
        <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
        
    <span class="c1">## Set if the mesh should be plotted</span>
    <span class="n">meshOpt</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mesh&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        
    <span class="c1">## Set if solid polygons should be plotted for nan values.</span>
    <span class="n">nanSolidPoly</span>        <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nanSolidPoly&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">nanSolidPolyOutline</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nanSolidPolyOutline&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1">## Set if the coastline should be plotted</span>
    <span class="n">coastlinesOpt</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coastlines&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>

    <span class="c1">## Set option to add contour for zero value</span>
    <span class="n">plotZeroContour</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotZeroContour&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
    
    <span class="c1">## Set default option for plotIntegerContours</span>
    <span class="n">plotIntegerContours</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
    
    <span class="c1">## Get cmap at &#39;cbar-intervals&#39;</span>
    <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">])</span>
    
    <span class="c1">## Add the plot using pcolormesh</span>
    <span class="k">if</span> <span class="n">meshOpt</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">vmax</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">vmax</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">## Add zero value contour</span>
    <span class="k">if</span> <span class="n">plotZeroContour</span><span class="p">:</span>
        <span class="c1"># Set any np.nan values to 0.ccrs</span>
        <span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">zeroContour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1">## Add solid polygons for nan values</span>
    <span class="k">if</span> <span class="n">nanSolidPoly</span><span class="p">:</span>
        <span class="n">valuesNan</span>                   <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)</span>
        <span class="n">valuesNan</span><span class="p">[:]</span>                <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span>
        <span class="n">valuesNan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">mesh2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesNan</span><span class="p">,</span>
                              <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1">## Add Line around clusters of nan values</span>
    <span class="k">if</span> <span class="n">nanSolidPolyOutline</span><span class="p">:</span>
        <span class="n">valuesNan</span>                   <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)</span>
        <span class="n">valuesNan</span><span class="p">[:]</span>                <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">valuesNan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">nanContour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesNan</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">## Add contours in integer steps (useful for dividing catagorical data)</span>
    <span class="n">valuesContour</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotIntegerContours</span><span class="p">:</span>
        <span class="c1"># Set any np.nan values to 0.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">))):</span>
            <span class="n">valuesContour</span><span class="p">[</span><span class="n">BasinIDA</span><span class="o">==</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">valuesContour</span><span class="p">[</span><span class="n">BasinIDA</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesContour</span><span class="p">,</span>
                       <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">colors</span><span class="o">=</span><span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;boundaryColor&quot;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">),</span>
                       <span class="n">linewidths</span><span class="o">=</span><span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;boundaryLinewidth&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                       <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            
            
    <span class="c1">## Add coastlines</span>
    <span class="k">if</span> <span class="n">coastlinesOpt</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1">## Add a colorbar</span>
    <span class="k">if</span> <span class="n">meshOpt</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1">## Set cbar name</span>
        <span class="k">if</span> <span class="n">regionalZBoundaries</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Regional </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust the size of colorbar ticks</span>

    <span class="c1">## Add gridlines</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">):</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                          <span class="n">xlocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                          <span class="n">ylocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                         <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                          <span class="n">xlocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                          <span class="n">ylocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                         <span class="p">)</span>

        <span class="n">gl</span><span class="o">.</span><span class="n">xlabels_top</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabels_bottom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabels_left</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabels_right</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set the tick label color here</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="c1">## Set a title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;plotTitle&#39;</span><span class="p">])</span>

    <span class="c1">## Set transparency value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">];</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="c1"># Save figure</span>
    <span class="k">if</span> <span class="n">savePNG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">saveSVG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="plotGlobalSilhouette">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plotGlobalSilhouette">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotGlobalSilhouette</span><span class="p">(</span>
    <span class="n">lat</span><span class="p">,</span>
    <span class="n">lon</span><span class="p">,</span>
    <span class="n">values</span><span class="p">,</span>
    <span class="n">BasinIDA</span><span class="p">,</span>
    <span class="n">outputDir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">fidName</span><span class="o">=</span><span class="s2">&quot;plotGlobal_silhouette.png&quot;</span><span class="p">,</span>
    <span class="n">cmapOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;jet&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-title&quot;</span><span class="p">:</span> <span class="s2">&quot;cbar-title&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="s2">&quot;cbar-levels&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.25</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
              <span class="s2">&quot;cbar-intervals&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.25</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
              <span class="s2">&quot;cbar-level-names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Weak&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium&quot;</span><span class="p">,</span> <span class="s2">&quot;Strong&quot;</span><span class="p">]},</span>
    <span class="n">pltOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;valueType&quot;</span><span class="p">:</span> <span class="s2">&quot;Silhouette Structure&quot;</span><span class="p">,</span>
             <span class="s2">&quot;valueUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotTitle&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotZeroContour&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;nanSolidPoly&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s2">&quot;nanSolidPolyOutline&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="s2">&quot;regionalZBoundaries&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
             <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
             <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(),</span>
             <span class="s2">&quot;transparent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">saveSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">savePNG</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a global (or regional) **silhouette** field with discrete color levels and basin boundaries.</span>

<span class="sd">    Renders a gridded silhouette metric (``values``) on a Cartopy map using a **discrete**</span>
<span class="sd">    colormap defined by ``cmapOpts[&quot;cbar-levels&quot;]`` and ``BoundaryNorm``. Optionally</span>
<span class="sd">    overlays basin boundaries derived from ``BasinIDA``, draws NaN masks, and labels a</span>
<span class="sd">    horizontal colorbar with category names supplied via ``&quot;cbar-level-names&quot;``.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray):  </span>
<span class="sd">            2-D array of cell-centered latitudes in degrees (same shape as ``values``).</span>
<span class="sd">        lon (numpy.ndarray):  </span>
<span class="sd">            2-D array of cell-centered longitudes in degrees (same shape as ``values``).</span>
<span class="sd">        values (numpy.ndarray):  </span>
<span class="sd">            2-D array of silhouette values to shade; may include ``NaN``.</span>
<span class="sd">        BasinIDA (numpy.ndarray):  </span>
<span class="sd">            2-D array of integer/categorical basin IDs aligned with ``values`` for</span>
<span class="sd">            boundary overlays and NaN masks.</span>
<span class="sd">        outputDir (str, optional):  </span>
<span class="sd">            Directory to which the figure is saved. Defaults to ``&quot;&quot;`` (current behavior</span>
<span class="sd">            depends on Matplotlibâ€™s savefig path).</span>
<span class="sd">        fidName (str, optional):  </span>
<span class="sd">            Filename for PNG output. The SVG name is derived by replacing ``.png`` with ``.svg``.</span>
<span class="sd">        cmapOpts (dict, optional):  </span>
<span class="sd">            Discrete colormap and colorbar settings:</span>
<span class="sd">            - ``&quot;cmap&quot;`` (str): Matplotlib colormap name (resolved via ``plt.cm.get_cmap``).  </span>
<span class="sd">            - ``&quot;cbar-title&quot;`` (str): Title for the colorbar (not always used).  </span>
<span class="sd">            - ``&quot;cbar-range&quot;`` (list[float, float]): Overall numeric range (may be unused with discrete norm).  </span>
<span class="sd">            - ``&quot;cbar-levels&quot;`` (array-like): Monotonic sequence of bin edges for discrete coloring.  </span>
<span class="sd">            - ``&quot;cbar-intervals&quot;`` (array-like): Provided but unused here (kept for API symmetry).  </span>
<span class="sd">            - ``&quot;cbar-level-names&quot;`` (list[str]): Labels for colorbar ticks; one fewer or equal to the number</span>
<span class="sd">              of edges depending on labeling strategy (this function labels mid-bin positions).</span>
<span class="sd">        pltOpts (dict, optional):  </span>
<span class="sd">            Plot behavior and aesthetics:</span>
<span class="sd">            - ``&quot;valueType&quot;`` (str): Label for data type (used in colorbar label).  </span>
<span class="sd">            - ``&quot;valueUnits&quot;`` (str): Units for colorbar label.  </span>
<span class="sd">            - ``&quot;plotTitle&quot;`` (str): Figure title.  </span>
<span class="sd">            - ``&quot;plotZeroContour&quot;`` (bool): If True, overlays a zero contour of ``values``.  </span>
<span class="sd">            - ``&quot;nanSolidPoly&quot;`` (bool): If True, fills NaN regions derived from ``BasinIDA``.  </span>
<span class="sd">            - ``&quot;nanSolidPolyOutline&quot;`` (bool): If True, outlines contiguous NaN regions.  </span>
<span class="sd">            - ``&quot;plotIntegerContours&quot;`` (bool): If True, draws per-basin boundary contours from ``BasinIDA``.  </span>
<span class="sd">            - ``&quot;regionalZBoundaries&quot;`` (bool): If True, masks ``values`` outside ``&quot;region&quot;`` and remaps</span>
<span class="sd">              unique in-range values to consecutive integers starting at 0; updates colorbar range.  </span>
<span class="sd">            - ``&quot;region&quot;`` (list[float, float, float, float]): Extent ``[lon_min, lon_max, lat_min, lat_max]``.  </span>
<span class="sd">            - ``&quot;projection&quot;`` (cartopy.crs.Projection): Target projection (default Mollweide).  </span>
<span class="sd">            - ``&quot;transparent&quot;`` (bool): If True, saves with transparent background.</span>
<span class="sd">        saveSVG (bool, optional):  </span>
<span class="sd">            Save an SVG alongside PNG. Defaults to ``False``.</span>
<span class="sd">        savePNG (bool, optional):  </span>
<span class="sd">            Save a PNG using ``fidName``. Defaults to ``False``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None:  </span>
<span class="sd">            Writes figure(s) to disk if requested; no value is returned.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:  </span>
<span class="sd">            If input array shapes are inconsistent. *(Not explicitly validated here.)*  </span>
<span class="sd">        FileNotFoundError:  </span>
<span class="sd">            If ``outputDir`` is invalid/unwritable. *(Depends on Matplotlib/OS behavior.)*  </span>
<span class="sd">        Exception:  </span>
<span class="sd">            Any Matplotlib/Cartopy runtime errors encountered during plotting or saving.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - **Discrete colormap:** Coloring uses ``mpl.colors.BoundaryNorm(cbar-levels, cmap.N)`` so bins are</span>
<span class="sd">          closed-open intervals aligned to your silhouette thresholds.  </span>
<span class="sd">        - **Colorbar ticks:** Tick positions are set at bin midpoints and labeled with ``&quot;cbar-level-names&quot;``.  </span>
<span class="sd">        - **Boundaries:** Basin boundaries are drawn by thresholding each integer ID in ``BasinIDA`` and</span>
<span class="sd">          contouring at 0.5. NaN masks (fill/outline) are derived from ``BasinIDA`` NaNs.  </span>
<span class="sd">        - **Regional masking:** With ``regionalZBoundaries=True``, values outside ``region`` are set to NaN</span>
<span class="sd">          and remaining unique values are renumbered 0..N-1, updating the colorbar range accordingly.  </span>
<span class="sd">        - ``pcolormesh`` uses ``transform=ccrs.PlateCarree()`` to map lon/lat into the selected projection.</span>

<span class="sd">    Example:</span>
<span class="sd">        Plot silhouette strength categories with custom labels:</span>

<span class="sd">        ```python</span>
<span class="sd">        cmapOpts = {</span>
<span class="sd">            &quot;cmap&quot;: &quot;viridis&quot;,</span>
<span class="sd">            &quot;cbar-levels&quot;: np.array([0.0, 0.25, 0.5, 0.7, 1.0]),</span>
<span class="sd">            &quot;cbar-level-names&quot;: [&quot;No&quot;, &quot;Weak&quot;, &quot;Medium&quot;, &quot;Strong&quot;]</span>
<span class="sd">        }</span>
<span class="sd">        pltOpts = {</span>
<span class="sd">            &quot;valueType&quot;: &quot;Silhouette&quot;,</span>
<span class="sd">            &quot;valueUnits&quot;: &quot;-&quot;,</span>
<span class="sd">            &quot;plotTitle&quot;: &quot;Silhouette categories&quot;,</span>
<span class="sd">            &quot;projection&quot;: ccrs.Mollweide(),</span>
<span class="sd">            &quot;plotIntegerContours&quot;: True,</span>
<span class="sd">            &quot;transparent&quot;: True</span>
<span class="sd">        }</span>
<span class="sd">        plotGlobalSilhouette(lat, lon, sil_values, basin_ids,</span>
<span class="sd">                             outputDir=&quot;figs&quot;, fidName=&quot;silhouette.png&quot;,</span>
<span class="sd">                             cmapOpts=cmapOpts, pltOpts=pltOpts, savePNG=True)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Copy values such that the arguments are not changed, if</span>
    <span class="c1"># say they are from a class attribute.</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Start making figure</span>
    <span class="c1">## Create a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    
    <span class="c1">## Set projection and extent</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">())</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>

    <span class="c1">## Set up the Mollweide projection</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    
    <span class="c1">## Set default for option to use regional Zvalue boundaries</span>
    <span class="n">regionalZBoundaries</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regionalZBoundaries&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">regionalZBoundaries</span><span class="p">:</span>
        <span class="c1"># Set values outside of region to nan</span>
        <span class="n">values</span><span class="p">[</span> <span class="o">~</span><span class="p">((</span><span class="n">lon</span><span class="o">&gt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lon</span><span class="o">&lt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lat</span><span class="o">&gt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">lat</span><span class="o">&lt;=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Reset indexing</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">values</span><span class="o">==</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span>
                <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
        
        <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
        
    <span class="c1">## Set if the mesh should be plotted</span>
    <span class="n">meshOpt</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mesh&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        
    <span class="c1">## Set if solid polygons should be plotted for nan values.</span>
    <span class="n">nanSolidPoly</span>        <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nanSolidPoly&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">nanSolidPolyOutline</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nanSolidPolyOutline&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1">## Set if the coastline should be plotted</span>
    <span class="n">coastlinesOpt</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coastlines&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>

    <span class="c1">## Set option to add contour for zero value</span>
    <span class="n">plotZeroContour</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotZeroContour&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
    
    <span class="c1">## Set default option for plotIntegerContours</span>
    <span class="n">plotIntegerContours</span> <span class="o">=</span> <span class="n">pltOpts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
    
    <span class="c1">## Get cmap at &#39;cbar-intervals&#39;</span>
    <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">])</span>
    
    <span class="c1">## Add the plot using pcolormesh</span>
    <span class="k">if</span> <span class="n">meshOpt</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                                <span class="n">levels</span> <span class="o">=</span> <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-levels&quot;</span><span class="p">],</span>
                                <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-levels&quot;</span><span class="p">],</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                                <span class="c1"># vmin=cmapOpts[&#39;cbar-range&#39;][0], vmax=cmapOpts[&#39;cbar-range&#39;][1],</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                                <span class="n">norm</span><span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-levels&quot;</span><span class="p">],</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                                <span class="c1">#vmin=cmapOpts[&#39;cbar-range&#39;][0], vmax=cmapOpts[&#39;cbar-range&#39;][1],</span>
    

    <span class="c1">## Add zero value contour</span>
    <span class="k">if</span> <span class="n">plotZeroContour</span><span class="p">:</span>
        <span class="c1"># Set any np.nan values to 0.ccrs</span>
        <span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">zeroContour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1">## Add solid polygons for nan values</span>
    <span class="k">if</span> <span class="n">nanSolidPoly</span><span class="p">:</span>
        <span class="n">valuesNan</span>                   <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)</span>
        <span class="n">valuesNan</span><span class="p">[:]</span>                <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span>
        <span class="n">valuesNan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">mesh2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesNan</span><span class="p">,</span>
                              <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1">## Add Line around clusters of nan values</span>
    <span class="k">if</span> <span class="n">nanSolidPolyOutline</span><span class="p">:</span>
        <span class="n">valuesNan</span>                   <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)</span>
        <span class="n">valuesNan</span><span class="p">[:]</span>                <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">valuesNan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">nanContour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesNan</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                                <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">## Add contours in integer steps (useful for dividing catagorical data)</span>
    <span class="n">valuesContour</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotIntegerContours</span><span class="p">:</span>
        <span class="c1"># Set any np.nan values to 0.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">BasinIDA</span><span class="p">))):</span>
            <span class="n">valuesContour</span><span class="p">[</span><span class="n">BasinIDA</span><span class="o">==</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">valuesContour</span><span class="p">[</span><span class="n">BasinIDA</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">valuesContour</span><span class="p">,</span>
                       <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                       <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">## Add coastlines</span>
    <span class="k">if</span> <span class="n">coastlinesOpt</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1">## Add a colorbar</span>
    <span class="k">if</span> <span class="n">meshOpt</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="c1"># Define silhouette values that are </span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-levels&quot;</span><span class="p">]</span>
        <span class="n">cbarTicks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">cbarTickNames</span> <span class="o">=</span> <span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cbar-level-names&quot;</span><span class="p">]</span>
        
        <span class="c1"># Set tick marks and names</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">cbarTicks</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">cbarTickNames</span><span class="p">)</span>

        <span class="c1">## Set cbar name</span>
        <span class="k">if</span> <span class="n">regionalZBoundaries</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Regional </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust the size of colorbar ticks</span>

    <span class="c1">## Add gridlines</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">):</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                          <span class="n">xlocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                          <span class="n">ylocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                         <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                          <span class="n">xlocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                          <span class="n">ylocs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                         <span class="p">)</span>

        <span class="n">gl</span><span class="o">.</span><span class="n">xlabels_top</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabels_bottom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabels_left</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabels_right</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set the tick label color here</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="c1">## Set a title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;plotTitle&#39;</span><span class="p">])</span>

    <span class="c1">## Set transparency value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">];</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="c1"># Save figure</span>
    <span class="k">if</span> <span class="n">savePNG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;transparent&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">saveSVG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="plotGlobalwHist">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plotGlobalwHist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotGlobalwHist</span><span class="p">(</span>
    <span class="n">lat</span><span class="p">,</span>
    <span class="n">lon</span><span class="p">,</span>
    <span class="n">values</span><span class="p">,</span>
    <span class="n">binEdges</span><span class="p">,</span>
    <span class="n">bathymetryAreaDist_wHighlat</span><span class="p">,</span>
    <span class="n">bathymetryAreaDist</span><span class="p">,</span>
    <span class="n">highlatlat</span><span class="p">,</span>
    <span class="n">outputDir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">fidName</span><span class="o">=</span><span class="s2">&quot;plotGlobal.png&quot;</span><span class="p">,</span>
    <span class="n">cmapOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-title&quot;</span><span class="p">:</span> <span class="s2">&quot;cbar-title&quot;</span><span class="p">,</span>
              <span class="s2">&quot;cbar-range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
    <span class="n">pltOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;valueType&quot;</span><span class="p">:</span> <span class="s2">&quot;Bathymetry&quot;</span><span class="p">,</span>
             <span class="s2">&quot;valueUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotTitle&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="s2">&quot;plotZeroContour&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">saveSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">savePNG</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a global (Mollweide) gridded map with a stacked histogram underneath.</span>

<span class="sd">    The top panel renders a latitude/longitude gridded field (``values``) on a</span>
<span class="sd">    Cartopy Mollweide projection with an accompanying horizontal colorbar.</span>
<span class="sd">    The bottom panel draws a side-by-side bar chart comparing two bathymetry</span>
<span class="sd">    area distributions across common bins (``binEdges``).</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray):  </span>
<span class="sd">            2-D array of **cell-centered** latitudes in degrees, same shape as ``values``.</span>
<span class="sd">        lon (numpy.ndarray):  </span>
<span class="sd">            2-D array of **cell-centered** longitudes in degrees, same shape as ``values``.</span>
<span class="sd">        values (numpy.ndarray):  </span>
<span class="sd">            2-D array of gridded data to shade (same shape as ``lat``/``lon``). May contain ``NaN``.</span>
<span class="sd">        binEdges (array-like):  </span>
<span class="sd">            Monotonically increasing 1-D array of bin edges (length ``N+1``) for the histogram x-axis.</span>
<span class="sd">        bathymetryAreaDist_wHighlat (array-like):  </span>
<span class="sd">            Length-``N`` array of area percentages (or other weights) for **all** bathymetry.</span>
<span class="sd">        bathymetryAreaDist (array-like):  </span>
<span class="sd">            Length-``N`` array of area percentages for the bathymetry **excluding** high-latitude data.</span>
<span class="sd">        highlatlat (float):  </span>
<span class="sd">            Latitude threshold (in degrees) used to define the â€œhigh-latitudeâ€ removal, for legend text.</span>
<span class="sd">        outputDir (str, optional):  </span>
<span class="sd">            Directory to which the figure is saved. Defaults to ``&quot;&quot;`` (current behavior</span>
<span class="sd">            depends on Matplotlibâ€™s savefig path).</span>
<span class="sd">        fidName (str, optional):  </span>
<span class="sd">            PNG output filename (also used to derive SVG name). Defaults to ``&quot;plotGlobal.png&quot;``.</span>
<span class="sd">        cmapOpts (dict, optional):  </span>
<span class="sd">            Colormap configuration:</span>
<span class="sd">            - ``&quot;cmap&quot;`` (str or Colormap): Name/object passed to ``pcolormesh``.  </span>
<span class="sd">            - ``&quot;cbar-title&quot;`` (str): (Not directly used here; label is derived from ``pltOpts``).  </span>
<span class="sd">            - ``&quot;cbar-range&quot;`` (list[float, float]): ``[vmin, vmax]`` for shading.</span>
<span class="sd">        pltOpts (dict, optional):  </span>
<span class="sd">            Plot appearance and behavior:</span>
<span class="sd">            - ``&quot;valueType&quot;`` (str): Label for colorbar (e.g., *Bathymetry*).  </span>
<span class="sd">            - ``&quot;valueUnits&quot;`` (str): Units label (e.g., *m*).  </span>
<span class="sd">            - ``&quot;plotTitle&quot;`` (str): Overall figure title.  </span>
<span class="sd">            - ``&quot;plotZeroContour&quot;`` (bool): If True, overlay a 0-contour on the map panel.</span>
<span class="sd">        saveSVG (bool, optional):  </span>
<span class="sd">            If True, save an SVG copy (``fidName`` with ``.svg``). Defaults to False.</span>
<span class="sd">        savePNG (bool, optional):  </span>
<span class="sd">            If True, save a PNG using ``fidName``. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None:  </span>
<span class="sd">            Writes the composed figure to disk when requested; no value is returned.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:  </span>
<span class="sd">            If the histogram inputs have incompatible lengths (caller responsibility; not checked here).</span>
<span class="sd">        FileNotFoundError:  </span>
<span class="sd">            If ``outputDir`` is invalid/unwritable. *(Depends on Matplotlib/OS behavior.)*</span>
<span class="sd">        Exception:  </span>
<span class="sd">            Any Cartopy/Matplotlib errors encountered during plotting or saving.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The upper map uses ``pcolormesh`` with ``transform=ccrs.PlateCarree()`` onto a Mollweide axes.  </span>
<span class="sd">        - The colorbar label is formed from ``pltOpts[&quot;valueType&quot;]`` and ``pltOpts[&quot;valueUnits&quot;]``.  </span>
<span class="sd">        - The histogram shows two bar series at each bin center, offset slightly to avoid overlap.  </span>
<span class="sd">        - Gridlines are drawn on the map via ``ax1.gridlines()`` with library defaults.</span>

<span class="sd">    Example:</span>
<span class="sd">        Render a bathymetry map and a bin-wise area comparison:</span>

<span class="sd">        ```python</span>
<span class="sd">        cmapOpts = {&quot;cmap&quot;: &quot;viridis&quot;, &quot;cbar-range&quot;: [-6000, 6000]}</span>
<span class="sd">        pltOpts  = {&quot;valueType&quot;: &quot;Bathymetry&quot;, &quot;valueUnits&quot;: &quot;m&quot;, &quot;plotTitle&quot;: &quot;Global bathymetry&quot;,</span>
<span class="sd">                    &quot;plotZeroContour&quot;: True}</span>
<span class="sd">        plotGlobalwHist(lat, lon, z, binEdges,</span>
<span class="sd">                        area_all, area_no_highlat, 60.0,</span>
<span class="sd">                        outputDir=&quot;figs&quot;, fidName=&quot;bathymetry_map_hist.png&quot;,</span>
<span class="sd">                        cmapOpts=cmapOpts, pltOpts=pltOpts, savePNG=True)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Start making figure</span>
    <span class="c1">## Create a figure</span>
    
    <span class="c1">## Set up the Mollweide projection</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>  <span class="c1"># 2 rows, 1 column, with the first row 3 times taller</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">());</span>

    <span class="c1">## Add the plot using pcolormesh</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">],</span>
                         <span class="n">vmin</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">cmapOpts</span><span class="p">[</span><span class="s1">&#39;cbar-range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s2">&quot;plotZeroContour&quot;</span><span class="p">]:</span>
        <span class="c1"># Set any np.nan values to 0.</span>
        <span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">zeroContour</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1">## Add a colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueType&#39;</span><span class="p">],</span> <span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;valueUnits&#39;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust the size of colorbar ticks</span>

    <span class="c1">## Add gridlines</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>

    <span class="c1">## Set a title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">[</span><span class="s1">&#39;plotTitle&#39;</span><span class="p">])</span>

    <span class="c1">## Make histogram plot</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    
    <span class="n">factor1</span> <span class="o">=</span> <span class="mf">.2</span>
    <span class="n">factor2</span> <span class="o">=</span> <span class="mf">.25</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">binEdges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="p">(</span><span class="n">factor2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">binEdges</span><span class="p">),</span>
            <span class="n">height</span><span class="o">=</span><span class="n">bathymetryAreaDist_wHighlat</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">factor1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">binEdges</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span> <span class="s2">&quot;All bathymetry&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">binEdges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="p">(</span><span class="n">factor2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">binEdges</span><span class="p">),</span>
            <span class="n">height</span><span class="o">=</span><span class="n">bathymetryAreaDist</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">factor1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">binEdges</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span> <span class="s2">&quot;Removed high latitude bathymetry: </span><span class="si">{:2.1f}</span><span class="s2"> degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">highlatlat</span><span class="p">))</span>
    <span class="c1"># ticks</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">binEdges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>

    <span class="c1"># Labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Planet&#39;s Bathymetry Distribution&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bathymetry Bins [km]&quot;</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Seafloor Area [%]&quot;</span><span class="p">);</span>

    <span class="c1"># figure format</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Save figure</span>
    <span class="k">if</span> <span class="n">savePNG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">saveSVG</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="n">fidName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="plotLargeBasins">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plotLargeBasins">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotLargeBasins</span><span class="p">(</span>
    <span class="n">basins</span><span class="p">,</span>
    <span class="n">fieldNum</span><span class="o">=</span><span class="s2">&quot;Field1&quot;</span><span class="p">,</span>
    <span class="n">percentage</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">fldName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">savePNG</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot only the basins whose area exceeds a given fraction of the domain.</span>

<span class="sd">    This function computes area-weighted sizes of each basin (using</span>
<span class="sd">    ``basins.areaWeights`` masked by ``basins.BasinIDA``), removes basins whose</span>
<span class="sd">    area is below ``percentage * total_area``, reindexes the remaining basins to</span>
<span class="sd">    consecutive integers starting at 0, and renders a categorical global map via</span>
<span class="sd">    :func:`plotGlobal`.</span>

<span class="sd">    Args:</span>
<span class="sd">        basins:  </span>
<span class="sd">            ExoCcycle-style object that provides at least the attributes:</span>
<span class="sd">            - ``lat`` (2-D array): cell-centered latitudes (deg)</span>
<span class="sd">            - ``lon`` (2-D array): cell-centered longitudes (deg)</span>
<span class="sd">            - ``BasinIDA`` (2-D array): integer/categorical basin IDs (``NaN`` for no data)</span>
<span class="sd">            - ``areaWeights`` (2-D array): area per cell (same shape as ``BasinIDA``)</span>
<span class="sd">            - ``Fields`` (dict-like): metadata; accessed as ``basins.Fields[fieldNum]``</span>
<span class="sd">        fieldNum (str, optional):  </span>
<span class="sd">            Key into ``basins.Fields`` used **only** to label the colorbar title as</span>
<span class="sd">            ``&quot;BasinID divided by {parameterName}&quot;``. Defaults to ``&quot;Field1&quot;``.</span>
<span class="sd">        percentage (float, optional):  </span>
<span class="sd">            Minimum fraction of the total represented area a basin must cover to be</span>
<span class="sd">            retained (e.g., ``0.05`` for 5%). Defaults to ``0.05``.</span>
<span class="sd">        fldName (str, optional):  </span>
<span class="sd">            Directory to save the resulting figure. Defaults to ``&quot;&quot;`` (current behavior</span>
<span class="sd">            depends on :func:`plotGlobal`).</span>
<span class="sd">        savePNG (bool, optional):  </span>
<span class="sd">            If ``True``, writes a PNG to disk using :func:`plotGlobal`. Defaults to ``False``.</span>
<span class="sd">        verbose (bool, optional):  </span>
<span class="sd">            If ``True``, prints summary information about kept/removed basins. Defaults to ``True``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None:  </span>
<span class="sd">            Writes a figure to disk when ``savePNG`` is True; no value is returned.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError:  </span>
<span class="sd">            If ``fieldNum`` is not present in ``basins.Fields``. *(Not validated here.)*</span>
<span class="sd">        ValueError:  </span>
<span class="sd">            If ``percentage`` is outside ``[0, 1]``. *(Not validated here.)*</span>
<span class="sd">        Exception:  </span>
<span class="sd">            Any errors raised downstream by :func:`plotGlobal` or file I/O.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Basins whose area (sum of ``areaWeights`` within each basin ID) is</span>
<span class="sd">          below ``percentage * total_area`` are set to ``NaN`` and excluded.</span>
<span class="sd">        - Remaining basin IDs are **reindexed** to 0..N-1 prior to plotting so that</span>
<span class="sd">          colormap limits reflect the new categorical range.</span>
<span class="sd">        - The plotted colorbar label uses</span>
<span class="sd">          ``basins.Fields[fieldNum][&#39;parameterName&#39;]`` for context.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        plotLargeBasins(basins, fieldNum=&quot;Field1&quot;, percentage=0.1,</span>
<span class="sd">                        fldName=&quot;figs&quot;, savePNG=True, verbose=True)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BasinIDAMod</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">basins</span><span class="o">.</span><span class="n">BasinIDA</span><span class="p">)</span>
    <span class="c1"># Make weights mask</span>
    <span class="n">areaWeights</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">basins</span><span class="o">.</span><span class="n">areaWeights</span><span class="p">)</span>
    <span class="n">areaWeights</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">basins</span><span class="o">.</span><span class="n">BasinIDA</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">TotalArea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">areaWeights</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TotalArea: </span><span class="si">{</span><span class="n">TotalArea</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Iterate over basins (communitieslen()</span>
    <span class="n">keepBasin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">BasinIDAMod</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">basinID</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">BasinIDAMod</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">basinID</span><span class="p">):</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">areaWeights</span><span class="p">[</span><span class="n">BasinIDAMod</span><span class="o">==</span><span class="n">basinID</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">TotalArea</span><span class="o">*</span><span class="n">percentage</span><span class="p">:</span>
            <span class="c1"># If total basin area is smaller than the percentage threshold. </span>
            <span class="n">keepBasin</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">basinID</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;basinID: </span><span class="si">{</span><span class="n">basinID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Smallest community plotted </span><span class="si">{</span><span class="n">TotalArea</span><span class="o">*</span><span class="n">percentage</span><span class="si">}</span><span class="s2"> km^2&quot;</span> <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Basins to be plotted (&gt;100 will take more than a minute): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">keepBasin</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="c1"># Remove small basins</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;len(np.unique(BasinIDAMod)): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">BasinIDAMod</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">basinID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keepBasin</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keepBasin</span><span class="p">[</span><span class="n">basinID</span><span class="p">]:</span>
            <span class="n">BasinIDAMod</span><span class="p">[</span><span class="n">BasinIDAMod</span><span class="o">==</span><span class="n">basinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span>

    <span class="c1"># Reindex large basins basins</span>
    <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">basinID</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">BasinIDAMod</span><span class="p">):</span>
        <span class="n">BasinIDAMod</span><span class="p">[</span><span class="n">BasinIDAMod</span><span class="o">==</span><span class="n">basinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span>
        <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
        
    <span class="c1"># Plot</span>
    <span class="n">plotGlobal</span><span class="p">(</span><span class="n">basins</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">basins</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">BasinIDAMod</span><span class="p">,</span>
               <span class="n">outputDir</span> <span class="o">=</span> <span class="n">fldName</span><span class="p">,</span>
               <span class="n">fidName</span> <span class="o">=</span> <span class="s2">&quot;plotGlobal_LargeBasins.png&quot;</span><span class="p">,</span>
               <span class="n">cmapOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;cbar-title&quot;</span><span class="p">:</span><span class="s2">&quot;cbar-title&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;cbar-range&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">BasinIDAMod</span><span class="p">)]},</span>
               <span class="n">pltOpts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;valueType&quot;</span><span class="p">:</span> <span class="s2">&quot;BasinID divided by </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basins</span><span class="o">.</span><span class="n">Fields</span><span class="p">[</span><span class="n">fieldNum</span><span class="p">][</span><span class="s1">&#39;parameterName&#39;</span><span class="p">]),</span>
                        <span class="s2">&quot;valueUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;plotTitle&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;plotZeroContour&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                        <span class="s2">&quot;plotIntegerContours&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;transparent&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
               <span class="n">savePNG</span><span class="o">=</span><span class="n">savePNG</span><span class="p">,</span>
               <span class="n">saveSVG</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<span class="c1">########################################################################</span>
<span class="c1">################ Plotting functions (Graph-Weighting)  #################</span>
<span class="c1">########################################################################</span>
<div class="viewcode-block" id="plot_quantile_transform_distribution">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plot_quantile_transform_distribution">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_quantile_transform_distribution</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">qt_transformer</span><span class="p">,</span> <span class="n">qt_diss</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot quantile transformation distributions for data vs. Gaussian (QT) domain.</span>

<span class="sd">    This function visualizes how an input dataset maps between its native domain</span>
<span class="sd">    and the quantile-transformed (Gaussianized) domain used in statistical weighting.</span>
<span class="sd">    It generates two subplots:</span>
<span class="sd">        1. Histogram of transformed values (QT domain)</span>
<span class="sd">        2. Comparison between original and back-transformed (inverse QT) data</span>

<span class="sd">    Args:</span>
<span class="sd">        x_values (array-like):  </span>
<span class="sd">            Original data values to transform.</span>
<span class="sd">        qt_transformer (object):  </span>
<span class="sd">            A fitted scikit-learn quantile transformer (e.g., </span>
<span class="sd">            ``sklearn.preprocessing.QuantileTransformer``) or similar object with</span>
<span class="sd">            ``.transform`` and ``.inverse_transform`` methods.</span>
<span class="sd">        qt_diss (array-like, optional):  </span>
<span class="sd">            Already-transformed data (QT domain). If None, it is computed from ``x_values``.</span>
<span class="sd">        field_name (str, optional):  </span>
<span class="sd">            Optional field label for plot legends/titles.</span>
<span class="sd">        bins (int, optional):  </span>
<span class="sd">            Number of bins for histograms. Defaults to 20.</span>
<span class="sd">        show (bool, optional):  </span>
<span class="sd">            Whether to immediately show the plots using ``plt.show()``. Defaults to True.</span>
<span class="sd">        save_path (str, optional):  </span>
<span class="sd">            Path to save the figure (e.g., ``&quot;figures/qt_transform_plot.png&quot;``). If None, the figure</span>
<span class="sd">            is not saved.</span>

<span class="sd">    Returns:</span>
<span class="sd">        matplotlib.figure.Figure:  </span>
<span class="sd">            The created matplotlib figure instance.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        from sklearn.preprocessing import QuantileTransformer</span>
<span class="sd">        import numpy as np</span>

<span class="sd">        qt = QuantileTransformer(output_distribution=&#39;normal&#39;)</span>
<span class="sd">        x = np.random.lognormal(mean=0, sigma=1, size=5000)</span>
<span class="sd">        qt.fit(x.reshape(-1, 1))</span>
<span class="sd">        plot_quantile_transform_distribution(x, qt)</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure numpy array</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>

    <span class="c1"># Compute transformed data if not given</span>
    <span class="k">if</span> <span class="n">qt_diss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qt_diss</span> <span class="o">=</span> <span class="n">qt_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Create equally spaced bins in the data domain</span>
    <span class="n">bins_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_values</span><span class="p">),</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">bins_qt</span> <span class="o">=</span> <span class="n">qt_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bins_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Create subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># --- (1) QT-domain histogram ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">qt_diss</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transformed (QT domain)&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_qt</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Quantile-Transformed Distribution&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># --- (2) Original vs. inverse-QT histogram ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Data&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_data</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">qtx_values</span> <span class="o">=</span> <span class="n">qt_transformer</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">qt_diss</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">qtx_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Back-Transformed (QTâ†’Data)&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Data Values&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original vs. Inverse QT Comparison&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Save or show</span>
    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="plot_pdf_vs_sigmoid">
<a class="viewcode-back" href="../../apidoc/ExoCcycle.html#ExoCcycle.plotHelper.plot_pdf_vs_sigmoid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_pdf_vs_sigmoid</span><span class="p">(</span>
    <span class="n">data_edge_diff_iqr_filtered</span><span class="p">,</span>
    <span class="n">pdf</span><span class="p">,</span>
    <span class="n">popt</span><span class="p">,</span>
    <span class="n">sigmoid_fn</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a fitted sigmoid against an empirical PDF, plus a histogram of the data.</span>

<span class="sd">    This function mirrors your snippet by:</span>
<span class="sd">      1) Mirroring the input data as ``x_values = [+x, -x]`` to enforce symmetry,</span>
<span class="sd">      2) Plotting the **normalized** PDF and **normalized** sigmoid in the top subplot,</span>
<span class="sd">      3) Plotting the **raw** PDF, a histogram of the mirrored data, and the **raw** sigmoid</span>
<span class="sd">         in the bottom subplot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_edge_diff_iqr_filtered : array-like, shape (N,)</span>
<span class="sd">        One-sided data array (e.g., positive differences). The function mirrors this</span>
<span class="sd">        array to construct ``x_values = np.append(x, -x)`` for plotting.</span>
<span class="sd">    pdf : array-like, shape (2N,)</span>
<span class="sd">        Empirical probability density values corresponding **one-to-one** with the</span>
<span class="sd">        mirrored ``x_values`` ordering used here (``[x, -x]`` in that sequence).</span>
<span class="sd">    popt : sequence</span>
<span class="sd">        Optimized parameters for the passed ``sigmoid_fn`` (e.g., from ``scipy.optimize.curve_fit``).</span>
<span class="sd">    sigmoid_fn : callable</span>
<span class="sd">        A callable with signature ``sigmoid_fn(x, *popt)`` that evaluates the sigmoid</span>
<span class="sd">        at vector ``x``.</span>
<span class="sd">    bins : int, optional</span>
<span class="sd">        Number of histogram bins for the data panel. Default is 30.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Figure-level title. Default None (no suptitle).</span>
<span class="sd">    show : bool, optional</span>
<span class="sd">        If True, call ``plt.show()`` at the end. Default True.</span>
<span class="sd">    save_path : str, optional</span>
<span class="sd">        If provided, save the figure to this path (e.g., ``&quot;figs/pdf_sigmoid.png&quot;``).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (fig, axes) : tuple</span>
<span class="sd">        The created Matplotlib figure and array of axes (length 2).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The top panel normalizes both curves for a shape-only comparison:</span>
<span class="sd">      ``pdf / max(pdf)`` and ``sigmoid(x)/sigmoid(0)``.</span>
<span class="sd">    - The bottom panel compares raw magnitudes: empirical PDF, histogram,</span>
<span class="sd">      and raw sigmoid evaluated on the mirrored grid.</span>
<span class="sd">    - Ensure ``pdf`` is aligned with the constructed mirrored ``x_values``. If your</span>
<span class="sd">      original PDF is defined on a different grid or order, resample/reorder before use.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; # Define a standard logistic sigmoid:</span>
<span class="sd">    &gt;&gt;&gt; def sigmoid(x, a, b, c, d):</span>
<span class="sd">    ...     return a / (1.0 + np.exp(-b*(x - c))) + d</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; x_pos = np.linspace(0, 3, 200)</span>
<span class="sd">    &gt;&gt;&gt; x_all = np.append(x_pos, -x_pos)</span>
<span class="sd">    &gt;&gt;&gt; pdf = np.exp(-0.5*(x_all/0.8)**2)  # toy Gaussian-shaped PDF on mirrored grid</span>
<span class="sd">    &gt;&gt;&gt; popt = (1.0, 2.0, 0.0, 0.0)        # toy params</span>
<span class="sd">    &gt;&gt;&gt; fig, axes = plot_pdf_vs_sigmoid(x_pos, pdf, popt, sigmoid, bins=30, show=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1) Build mirrored x-values</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_edge_diff_iqr_filtered</span><span class="p">),</span>
                         <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_edge_diff_iqr_filtered</span><span class="p">))</span>

    <span class="c1"># Sanity checks (lightweight)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pdf</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">x_values</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;`pdf` must have the same shape as mirrored data x_values: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdf</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">x_values</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># 2) Prepare figure and axes</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># --- Top subplot: normalized comparison (shape-only) ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">pdf_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">pdf_max</span> <span class="o">=</span> <span class="n">pdf_max</span> <span class="k">if</span> <span class="n">pdf_max</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="c1"># Normalize pdf by its max</span>
    <span class="n">pdf_norm</span> <span class="o">=</span> <span class="n">pdf</span> <span class="o">/</span> <span class="n">pdf_max</span>

    <span class="c1"># Normalize sigmoid by its value at x=0 (avoid div-by-zero)</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">sigmoid_fn</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">s0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="ow">and</span> <span class="n">s0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">sig_norm</span> <span class="o">=</span> <span class="n">sigmoid_fn</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span> <span class="o">/</span> <span class="n">s0</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">pdf_norm</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pdf (normalized)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">sig_norm</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sigmoid (normalized)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Normalized weight&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

    <span class="c1"># --- Bottom subplot: raw comparison + histogram ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pdf (raw)&#39;</span><span class="p">)</span>
    <span class="c1"># Histogram of the mirrored data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
             <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_values</span><span class="p">),</span> <span class="n">bins</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">sigmoid_fn</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sigmoid (raw)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Unnormalized weight&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Difference in Node Property&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>




</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ExoCcycle</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/modules.html">ExoCcycle</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, ExoCcycle authors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>